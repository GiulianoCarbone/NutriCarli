<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Nutricional de Carla üíñ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- PWA Meta Tags para iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Plan Carla">
    <link rel="apple-touch-icon" href="https://www.hcmarbella.com/wp-content/uploads/2015/07/logo_rosasanchezramiro.jpg">
    <!-- Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Aplicar la fuente Inter a todo el cuerpo */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para los links de recetas */
        .recipe-link {
            @apply text-primary-600 font-semibold underline decoration-dotted hover:text-primary-800 transition-colors;
        }
        /* Estilo para el switch de entrenamiento */
        /* 
          Usamos 'peer' para cambiar el estilo del fondo y del c√≠rculo 
          cuando el input (que es un 'peer') est√° 'checked'.
        */
        /* Ya no es necesario, la l√≥gica est√° en las clases de Tailwind */
        /* Estilo para botones de digesti√≥n seleccionados */
        .digestive-btn.selected {
            @apply ring-4 ring-primary-300 scale-110;
        }
        /* NUEVO: Animaci√≥n de pulso para el coraz√≥n */
        .animate-heart-pulse {
            display: inline-block; /* Necesario para que la transformaci√≥n funcione */
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }
    </style>
    <script>
        // Configuraci√≥n de la paleta de colores de Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // NUEVO: Paleta de colores 'rosa beb√©' (pink de Tailwind)
                        primary: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                            950: '#500724',
                        },
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-primary-50 min-h-screen flex items-center justify-center p-4 sm:p-8">

    <main class="w-full max-w-5xl mx-auto"> <!-- Aumentado el max-w para la grilla de 3 col -->
        <!-- Saludo Principal -->
        <header class="text-center mb-6">
            <h1 class="text-4xl sm:text-5xl font-bold text-primary-800">
                ¬°Hola, Carla! <span class="animate-heart-pulse">üíñ</span>
            </h1>
            <p id="subtitle" class="text-lg sm:text-xl text-primary-700 mt-2">Aqu√≠ est√° tu plan de hoy:</p>
        </header>

        <!-- NUEVO: Switch de Entrenamiento -->
        <div class="flex items-center justify-center mb-6 space-x-3">
            <span class="font-semibold text-primary-700">¬øD√≠a de Entrenamiento?</span>
            <!-- NUEVO SWITCH -->
            <label for="training-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="training-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 rounded-full peer-focus:ring-4 peer-focus:ring-primary-300 peer-checked:bg-primary-600"></div>
                <div class="absolute top-0.5 left-[2px] bg-white border-gray-300 border rounded-full h-5 w-5 transition-all peer-checked:translate-x-full peer-checked:border-white"></div>
            </label>
            <!-- FIN NUEVO SWITCH -->
            <span class="font-semibold text-primary-700">¬°S√≠! üèãÔ∏è‚Äç‚ôÄÔ∏è</span>
        </div>

        <!-- Card del Plan del D√≠a -->
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden mb-6">
            <!-- Header de la Card con Navegaci√≥n -->
            <div class="bg-primary-600 p-5 flex items-center justify-between">
                <button id="prev-day-btn" class="text-white p-2 rounded-full hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-white" aria-label="D√≠a anterior">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 id="day-title" class="text-3xl font-bold text-white text-center px-4">
                    Cargando plan...
                </h2>
                <button id="next-day-btn" class="text-white p-2 rounded-full hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-white" aria-label="D√≠a siguiente">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>
            </div>
            
            <!-- Contenido de la Card -->
            <div class="p-5 sm:p-8 grid md:grid-cols-2 gap-6">
                
                <!-- Desayuno -->
                <div>
                    <h3 class="text-2xl font-semibold text-primary-700 border-b-2 border-primary-100 pb-2 mb-3">
                        üç≥ Desayuno
                    </h3>
                    <p id="breakfast-plan" class="text-gray-700 leading-relaxed"></p>
                </div>

                <!-- Almuerzo -->
                <div>
                    <h3 class="text-2xl font-semibold text-primary-700 border-b-2 border-primary-100 pb-2 mb-3">
                        ü•ó Almuerzo
                    </h3>
                    <p id="lunch-plan" class="text-gray-700 leading-relaxed"></p>
                </div>

                <!-- Merienda -->
                <div>
                    <h3 class="text-2xl font-semibold text-primary-700 border-b-2 border-primary-100 pb-2 mb-3">
                        ‚òï Merienda
                    </h3>
                    <p id="snack-plan" class="text-gray-700 leading-relaxed"></p>
                </div>

                <!-- Cena -->
                <div>
                    <h3 class="text-2xl font-semibold text-primary-700 border-b-2 border-primary-100 pb-2 mb-3">
                        üåô Cena
                    </h3>
                    <p id="dinner-plan" class="text-gray-700 leading-relaxed"></p>
                </div>
            </div> <!-- Cierre de "Contenido de la Card" -->
        </div> <!-- Cierre de "Card del Plan del D√≠a" -->

        <!-- Grilla de 6 Tarjetas (NUEVA ESTRUCTURA) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
            <!-- Colaciones -->
            <div class="bg-white rounded-xl shadow-lg p-5 sm:p-6">
                <h3 class="text-2xl font-semibold text-primary-700 mb-3">üçé Colaciones</h3>
                <ul id="colaciones-list" class="list-disc list-inside text-gray-700 space-y-1">
                    <!-- Se rellena con JS -->
                </ul>
            </div>
<!-- Tracker de Hidrataci√≥n -->
            <div class="bg-white rounded-xl shadow-lg p-5 sm:p-6">
                <h3 class="text-2xl font-semibold text-primary-700 mb-3">üíß Meta de Hidrataci√≥n (3L)</h3>
                <p class="text-gray-600 text-sm mb-4">Clic en un vaso (250ml).</p>
                <div id="water-tracker" class="grid grid-cols-6 gap-3">
                    <!-- 12 vasos se generar√°n aqu√≠ con JS -->
                </div>
                <button id="reset-water" class="mt-4 w-full bg-primary-100 text-primary-700 font-medium py-2 px-4 rounded-lg hover:bg-primary-200 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-300">
                    Reiniciar
                </button>
            </div>
            <!-- Recordatorios -->
            <div class="bg-white rounded-xl shadow-lg p-5 sm:p-6">
                <h3 class="text-2xl font-semibold text-primary-700 mb-3">üíß Recordatorios Clave</h3>
                <ul id="recordatorios-list" class="list-disc list-inside text-gray-700 space-y-1">
                    <!-- Se rellena con JS -->
                </ul>
            </div>

            <!-- Tips de Preparaci√≥n Semanal -->
            <div class="bg-white rounded-xl shadow-lg p-5 sm:p-6">
                <h3 class="text-2xl font-semibold text-primary-700 mb-3">üí° Tips de Preparaci√≥n</h3>
                <ul id="meal-prep-list" class="list-disc list-inside text-gray-700 space-y-1">
                    <!-- Se rellena con JS -->
                </ul>
            </div>
            
            

            <!-- NUEVO: Diario Digestivo -->
            <div class="bg-white rounded-xl shadow-lg p-5 sm:p-6">
                <h3 class="text-2xl font-semibold text-primary-700 mb-3">üôÇ Mi Bienestar Digestivo</h3>
                <p class="text-gray-600 text-sm mb-4">¬øC√≥mo te sentiste hoy?</p>
                <div id="digestive-tracker" class="flex justify-around items-center">
                    <button class="digestive-btn p-2 rounded-full text-3xl transition-transform duration-200 hover:scale-110" data-value="1" aria-label="Mal">üò†</button>
                    <button class="digestive-btn p-2 rounded-full text-3xl transition-transform duration-200 hover:scale-110" data-value="2" aria-label="Algo mal">üòï</button>
                    <button class="digestive-btn p-2 rounded-full text-3xl transition-transform duration-200 hover:scale-110" data-value="3" aria-label="Neutral">üòê</button>
                    <button class="digestive-btn p-2 rounded-full text-3xl transition-transform duration-200 hover:scale-110" data-value="4" aria-label="Bien">üòä</button>
                    <button class="digestive-btn p-2 rounded-full text-3xl transition-transform duration-200 hover:scale-110" data-value="5" aria-label="Excelente">üòÑ</button>
                </div>
            </div>

            <!-- NUEVO: Bloc de Notas -->
            <div class="bg-white rounded-xl shadow-lg p-5 sm:p-6">
                <h3 class="text-2xl font-semibold text-primary-700 mb-3">üóíÔ∏è Mis Notas del D√≠a</h3>
                <textarea id="notes-textarea" class="w-full h-24 p-2 border border-primary-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-300" placeholder="Anotaciones, cambios o ideas..."></textarea>
            </div>

        </div>
        
        <!-- Modal Contenedor (Oculto por defecto) -->
        <div id="recipe-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
            <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-5 border-b">
                    <h3 id="modal-title" class="text-2xl font-semibold text-primary-700">Receta</h3>
                    <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <!-- Modal Content -->
                <div class="p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">Ingredientes:</h4>
                    <ul id="modal-ingredients" class="list-disc list-inside text-gray-700 mb-4 space-y-1">
                        <!-- Ingredientes se llenar√°n con JS -->
                    </ul>
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">Pasos:</h4>
                    <div id="modal-steps" class="text-gray-700 space-y-2">
                        <!-- Pasos se llenar√°n con JS -->
                    </div>
                </div>
            </div>
        </div>
        
    </main>

    <!-- Script para registrar el Service Worker de la PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado con √©xito:', registration);
                    })
                    .catch(error => {
                        console.log('‚ùå Error al registrar el Service Worker:', error);
                    });
            });
        }
    </script>

    <!-- L√≥gica de JavaScript -->
    <script>
        // Espera a que el contenido del DOM est√© cargado
        document.addEventListener('DOMContentLoaded', () => {

            // --- BASE DE DATOS DEL PLAN ---
            // El √≠ndice 0 es Domingo, 1 es Lunes, etc.
            const planSemanal = [
                // 0: Domingo
                {
                    dayName: "Domingo",
                    breakfast: "Yogur entero + 1 fruta chica a elecci√≥n con c√°scara + 1 cda de semillas de ch√≠a activadas + 1 cda de salvado de trigo.",
                    lunch: "2 rapiditas integrales con carne picada magra salteada, porotos negros (extra fibra), queso cremoso y verduras.",
                    snack: "Licuado de leche descremada + frutillas o ar√°ndanos + 1 cda de salvado de trigo.",
                    dinner: "¬º de tarta (si sobr√≥ del viernes) + Ensalada abundante de hojas verdes."
                },
                // 1: Lunes
                {
                    dayName: "Lunes",
                    breakfast: "Panqueques de avena <a href='#' class='recipe-link' data-recipe-id='panqueques'>(Ver receta)</a> (¬Ω banana, 1 huevo, 1 clara, 1 cda avena). Agregar 1 cda de ch√≠a activada. Topping: mitad de pera con c√°scara.",
                    lunch: "Bife de carne (150-200g) + Ensalada grande de verduras crudas (espinaca, zanahoria rallada) + ¬º de plato de arroz integral. Condimentar con 1 cda de aceite de oliva.",
                    snack: "Licuado de leche descremada + 1 fruta (ej. ciruela) + 1 cda de salvado de trigo.",
                    dinner: "Omelette de 2-3 huevos con verduras salteadas (champi√±ones, pimientos) y queso cremoso."
                },
                // 2: Martes
                {
                    dayName: "Martes",
                    breakfast: "2 tostadas de pan integral + 2 huevos revueltos (2 claras + 1 yema) + 1/2 palta chica + 1 kiwi con c√°scara (¬°bien lavado!).",
                    lunch: "Wook de pollo con fideos integrales (1 taza cocida). Cargar con abundantes verduras salteadas (br√≥coli, zanahoria, pimiento).",
                    snack: "Yogur entero o descremado + 1 fruta picada con c√°scara + 1 cda de semillas de ch√≠a activadas.",
                    dinner: "Pollo a la plancha (150-200g) + Ensalada grande de verduras crudas."
                },
                // 3: Mi√©rcoles
                {
                    dayName: "Mi√©rcoles",
                    breakfast: "Yogur entero con 1 cda de salvado de trigo, 1 cda de ch√≠a activada y 1 ciruela con c√°scara picada.",
                    lunch: "Guiso de lentejas <a href='#' class='recipe-link' data-recipe-id='lentejas'>(Ver receta)</a> (1.5 tazas) con verduras (zanahoria, pimiento, calabaza) y 1 huevo duro.",
                    snack: "3 tostadas integrales + 2 cdas de queso untable + 1 cda de semillas activadas.",
                    dinner: "Hamburguesa casera de pollo + Tortilla de verduras (huevo, acelga, queso)."
                },
                // 4: Jueves
                {
                    dayName: "Jueves",
                    breakfast: "Infusi√≥n + leche + 2 tostadas de pan integral + 2 cdas de queso crema + 2 de mermelada + 1 cda de semillas activadas + 1 fruta con c√°scara.",
                    lunch: "Filet de pescado al horno + Ensalada tipo 'rusa' (papa, zanahoria, arvejas, huevo) con aderezo de aceite de oliva o yogur natural.",
                    snack: "Licuado de leche descremada + 1 banana + 1 cda de avena.",
                    dinner: "¬Ω lata de at√∫n + 2 huevos duros + ensalada de arroz integral y verduras crudas (tomate, lechuga)."
                },
                // 5: Viernes
                {
                    dayName: "Viernes",
                    breakfast: "Panqueques de avena <a href='#' class='recipe-link' data-recipe-id='panqueques'>(Ver receta)</a> (receta del plan). Topping: 1 kiwi picado y 1 cdita de miel.",
                    lunch: "2 porciones de Tarta de verduras (acelga y ricota) + Ensalada mixta de tomate y zanahoria rallada.",
                    snack: "Yogur entero + 1 pu√±ado de frutos secos (30g).",
                    dinner: "2 rapiditas integrales rellenas de pollo salteado, palta (grasa saludable) y verduras crudas."
                },
                // 6: S√°bado
                {
                    dayName: "S√°bado",
                    breakfast: "2 tostadas de pan integral + 2 huevos revueltos + 1/2 palta chica + 1 pera con c√°scara.",
                    lunch: "Suprema al horno + Tortilla de verduras grande (huevo, zapallito, queso).",
                    snack: "3 tostadas integrales con 2 fetas de queso de m√°quina y 1 cdita de semillas activadas.",
                    dinner: "Salm√≥n (u otro pescado graso) a la plancha + Pur√© de calabaza + Ensalada de espinaca cruda."
                }
            ];
            
            // NUEVA base de datos de recetas
            const recipes = {
                panqueques: {
                    title: "Panqueques de Avena",
                    ingredients: [
                        "¬Ω banana pisada", "1 huevo", "1 clara", "1 cda sopera colmada de harina de avena",
                        "Esencia de vainilla (c/n)", "1 cdita de polvo de hornear", "Edulcorante (a gusto)"
                    ],
                    steps: [
                        "1. Mezclar todos los ingredientes en un bowl hasta que est√© homog√©neo.",
                        "2. Calentar una sart√©n de tefl√≥n a fuego bajo.",
                        "3. Verter la mezcla en la sart√©n.",
                        "4. Cocinar a fuego bajo hasta que salgan burbujas en la superficie.",
                        "5. Dar vuelta y cocinar por 1-2 minutos m√°s.",
                        "6. Servir con los toppings (pera, kiwi, etc.)."
                    ]
                },
                lentejas: {
                    title: "Guiso de Lentejas (Simple)",
                    ingredients: [
                        "1.5 tazas de lentejas cocidas (o 1 taza cruda)", "1/2 cebolla picada", "1/2 pimiento picado",
                        "1 zanahoria rallada o en cubos", "1/2 calabaza en cubos", "1 diente de ajo (opcional)",
                        "Condimentos: piment√≥n, comino, or√©gano", "Caldo de verdura (c/n)", "1 huevo duro (para servir)"
                    ],
                    steps: [
                        "1. En una olla, saltear la cebolla, el ajo y el pimiento.",
                        "2. Agregar la zanahoria y la calabaza. Cocinar por 5 minutos.",
                        "3. Si usas lentejas crudas, agregarlas y cubrir con caldo. Cocinar 30-40 min. Si usas cocidas, agregarlas al final.",
                        "4. Agregar los condimentos.",
                        "5. (Si usas cocidas) Agregar las lentejas y un poco de caldo. Calentar todo junto por 10 minutos.",
                        "6. Servir en un plato hondo y agregar el huevo duro picado por encima."
                    ]
                }
            };

            // MODIFICADO: Colaciones como objetos
            const colaciones = [
                { text: "1 fruta con c√°scara (manzana, pera, ciruela)", isTraining: false },
                { text: "1 pu√±ado de frutos secos (30g)", isTraining: true },
                { text: "1 yogur (entero o descremado)", isTraining: true },
                { text: "1 barrita de cereal (alta en fibra)", isTraining: false },
                { text: "3-4 fetas de queso de m√°quina", isTraining: false },
                { text: "1 huevo duro", isTraining: true }
            ];

            const recordatorios = [
                "Tomar 1 vaso de agua fr√≠a antes del desayuno.",
                "¬°Cumplir con los 3 litros de agua diarios!",
                "Preferir infusiones (mate, caf√©) y evitar el t√© de t√©.",
                "Activar las semillas (ch√≠a/lino) en agua antes de consumir.",
                "Hacer 2 colaciones al d√≠a."
            ];

            const mealPrepTips = [
                "Hervir 4-6 huevos y guardarlos en la heladera.",
                "Lavar y centrifugar verduras de hoja y guardar en tupper.",
                "Dejar semillas de ch√≠a en remojo en frascos individuales.",
                "Cocinar 1-2 tazas de arroz integral o fideos integrales.",
                "Cortar verduras (zanahoria, pimiento) para salteados.",
                "Separar porciones de pollo o carne para descongelar."
            ];

            // --- L√ìGICA DEL D√çA (MODIFICADA) ---

            const today = new Date().getDay();
            let currentDayIndex = today;

            // Elementos del DOM
            const trainingToggle = document.getElementById('training-toggle');
            const colacionesList = document.getElementById('colaciones-list');
            const digestiveButtons = document.querySelectorAll('.digestive-btn');
            const notesTextarea = document.getElementById('notes-textarea');

            // Funci√≥n para actualizar toda la info del plan en la p√°gina
            function updatePlan(dayIndex) {
                const plan = planSemanal[dayIndex];
                
                document.getElementById('day-title').textContent = plan.dayName;
                document.getElementById('breakfast-plan').innerHTML = plan.breakfast;
                document.getElementById('lunch-plan').innerHTML = plan.lunch;
                document.getElementById('snack-plan').innerHTML = plan.snack;
                document.getElementById('dinner-plan').innerHTML = plan.dinner;

                // Actualizar el subt√≠tulo
                document.getElementById('subtitle').textContent = (dayIndex === today) ? "Aqu√≠ est√° tu plan de hoy:" : "Est√°s viendo el plan del:";

                // Cargar estado de entrenamiento para este d√≠a
                const trainingKey = `trainingLog_${plan.dayName}`;
                const isTraining = JSON.parse(localStorage.getItem(trainingKey)) || false;
                trainingToggle.checked = isTraining;
                renderColaciones(isTraining); // Renderizar colaciones seg√∫n el estado

                // Cargar estado digestivo para este d√≠a
                const digestiveKey = `digestiveLog_${plan.dayName}`;
                const digestiveState = localStorage.getItem(digestiveKey) || "0"; // "0" = nada
                renderDigestiveLog(digestiveState);

                // Cargar notas para este d√≠a
                const notesKey = `notesLog_${plan.dayName}`;
                notesTextarea.value = localStorage.getItem(notesKey) || "";
            }

            // Rellenar las listas (solo se hace una vez)
            const recordatoriosList = document.getElementById('recordatorios-list');
            recordatoriosList.innerHTML = recordatorios.map(item => `<li>${item}</li>`).join('');

            const mealPrepList = document.getElementById('meal-prep-list');
            mealPrepList.innerHTML = mealPrepTips.map(item => `<li>${item}</li>`).join('');

            // Cargar el plan del d√≠a actual al iniciar
            updatePlan(currentDayIndex);

            // --- Event Listeners para los botones de navegaci√≥n ---
            document.getElementById('prev-day-btn').addEventListener('click', () => {
                currentDayIndex = (currentDayIndex - 1 + 7) % 7;
                updatePlan(currentDayIndex);
            });

            document.getElementById('next-day-btn').addEventListener('click', () => {
                currentDayIndex = (currentDayIndex + 1) % 7;
                updatePlan(currentDayIndex);
            });

            // --- NUEVO: L√≥gica del Switch de Entrenamiento ---
            
            // Funci√≥n para renderizar colaciones
            function renderColaciones(isTraining) {
                colacionesList.innerHTML = colaciones.map(item => 
                    `<li class="${(isTraining && item.isTraining) ? 'font-bold text-primary-700' : ''}">
                        ${(isTraining && item.isTraining) ? 'üèãÔ∏è‚Äç‚ôÄÔ∏è ' : ''}${item.text}
                     </li>`
                ).join('');
            }

            // Event listener para el switch
            trainingToggle.addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                const currentPlan = planSemanal[currentDayIndex];
                const trainingKey = `trainingLog_${currentPlan.dayName}`;
                
                // Guardar estado
                localStorage.setItem(trainingKey, JSON.stringify(isChecked));
                
                // Actualizar vista de colaciones
                renderColaciones(isChecked);
            });

            // --- NUEVO: L√≥gica del Diario Digestivo ---

            // Funci√≥n para renderizar estado digestivo
            function renderDigestiveLog(selectedValue) {
                digestiveButtons.forEach(btn => {
                    if (btn.dataset.value === selectedValue) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });
            }

            // Event listeners para los botones de digesti√≥n
            digestiveButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = btn.dataset.value;
                    const currentPlan = planSemanal[currentDayIndex];
                    const digestiveKey = `digestiveLog_${currentPlan.dayName}`;
                    
                    // Guardar estado
                    localStorage.setItem(digestiveKey, value);
                    
                    // Actualizar vista de botones
                    renderDigestiveLog(value);
                });
            });
            
            // --- NUEVO: L√≥gica de Notas ---
            notesTextarea.addEventListener('input', (e) => {
                const text = e.target.value;
                const currentPlan = planSemanal[currentDayIndex];
                const notesKey = `notesLog_${currentPlan.dayName}`;
                
                // Guardar estado
                localStorage.setItem(notesKey, text);
            });

            // --- L√ìGICA DEL TRACKER DE AGUA ---
            const waterTrackerContainer = document.getElementById('water-tracker');
            const resetWaterBtn = document.getElementById('reset-water');
            const todayDate = new Date().toISOString().split('T')[0];
            const waterKey = `waterTrack_${todayDate}`;
            let waterState = JSON.parse(localStorage.getItem(waterKey)) || Array(12).fill(false);

            function renderWaterTracker() {
                waterTrackerContainer.innerHTML = ''; 
                waterState.forEach((isToggled, index) => {
                    const glassBtn = document.createElement('button');
                    glassBtn.setAttribute('aria-label', `Vaso ${index + 1} de 12`);
                    glassBtn.dataset.index = index;
                    glassBtn.className = `p-2 rounded-lg transition-colors ${isToggled ? 'text-primary-500' : 'text-gray-300'} hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-300`;
                    glassBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M7 2a1 1 0 00-1 1v1H5a1 1 0 000 2h1v11a1 1 0 001 1h6a1 1 0 001-1V6h1a1 1 0 100-2h-1V3a1 1 0 00-1-1H7zm1 3v11h4V5H8z" clip-rule="evenodd" />
                                          </svg>`;
                    
                    glassBtn.addEventListener('click', () => {
                        waterState[index] = !waterState[index];
                        localStorage.setItem(waterKey, JSON.stringify(waterState));
                        glassBtn.classList.toggle('text-gray-300');
                        glassBtn.classList.toggle('text-primary-500');
                    });
                    waterTrackerContainer.appendChild(glassBtn);
                });
            }

            resetWaterBtn.addEventListener('click', () => {
                waterState = Array(12).fill(false);
                localStorage.setItem(waterKey, JSON.stringify(waterState));
                renderWaterTracker(); 
            });
            
            // Cargar el tracker de agua al iniciar (SOLO se carga el de HOY)
            renderWaterTracker();

            // --- L√ìGICA DEL MODAL DE RECETAS ---
            const modal = document.getElementById('recipe-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const mainContent = document.querySelector('main'); 

            const modalTitle = document.getElementById('modal-title');
            const modalIngredients = document.getElementById('modal-ingredients');
            const modalSteps = document.getElementById('modal-steps');

            function openRecipeModal(recipeId) {
                const recipe = recipes[recipeId];
                if (!recipe) return;
                modalTitle.textContent = recipe.title;
                modalIngredients.innerHTML = recipe.ingredients.map(item => `<li>${item}</li>`).join('');
                modalSteps.innerHTML = recipe.steps.map(item => `<p>${item}</p>`).join('');
                modal.classList.remove('hidden');
            }

            function closeRecipeModal() {
                modal.classList.add('hidden');
            }

            modalCloseBtn.addEventListener('click', closeRecipeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeRecipeModal();
            });

            mainContent.addEventListener('click', (e) => {
                const recipeLink = e.target.closest('.recipe-link');
                if (recipeLink) {
                    e.preventDefault(); 
                    openRecipeModal(recipeLink.dataset.recipeId);
                }
            });

        });
    </script>

</body>
</html>
